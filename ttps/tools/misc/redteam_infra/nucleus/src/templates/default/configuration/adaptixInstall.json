{
  "name": "Adaptix C2 Install",
  "type": "configuration",
  "variables": [
    {
      "name": "profile",
      "type": "file"
    },
    {
      "name": "service",
      "type": "file"
    }
  ],
  "value": "---\n- name: Setup Adaptix C2 Server\n  become: true\n\n  tasks:\n    - name: Install required packages\n      apt:\n        name:\n          - mingw-w64\n          - make\n          - git\n          - gcc\n        state: present\n        update_cache: yes\n\n    - name: Download Go 1.24.4\n      get_url:\n        url: https://go.dev/dl/go1.24.4.linux-amd64.tar.gz\n        dest: /tmp/go1.24.4.linux-amd64.tar.gz\n\n    - name: Remove existing Go installation\n      file:\n        path: \"{{ item }}\"\n        state: absent\n      loop:\n        - /usr/local/go\n        - /usr/local/bin/go\n\n    - name: Extract Go tarball\n      unarchive:\n        src: /tmp/go1.24.4.linux-amd64.tar.gz\n        dest: /usr/local\n        remote_src: yes\n\n    - name: Create symlink for Go binary\n      file:\n        src: /usr/local/go/bin/go\n        dest: /usr/local/bin/go\n        state: link\n\n    - name: Clone go-win7 repository\n      git:\n        repo: https://github.com/Adaptix-Framework/go-win7\n        dest: /tmp/go-win7\n\n    - name: Move go-win7 to /usr/lib\n      command: mv /tmp/go-win7 /usr/lib/\n      args:\n        creates: /usr/lib/go-win7\n\n    - name: Clone Adaptix repository\n      git:\n        repo: https://github.com/Adaptix-Framework/AdaptixC2.git\n        dest: /opt/adaptix\n        \n    - name: Set Go environment variables\n      command: go env -w CGO_ENABLED=1\n\n    - name: Run `make server`\n      make:\n        chdir: /opt/adaptix\n        target: server\n\n    - name: Run `make extenders` (May take a while)\n      command: make extenders\n      args:\n        chdir: /opt/adaptix\n      async: 1200 # Takes a while so we can make async\n      poll: 10\n      register: extenders_build_result\n      \n    - name: Fail if build timed out or failed\n      fail:\n        msg: \"Adaptix extender build failed or timed out.\"\n      when: extenders_build_result.rc != 0\n\n    - block:\n      - name: Generate self-signed SSL certificate non-interactively\n        command: >\n          openssl req -x509 -nodes -newkey rsa:2048\n          -keyout /opt/adaptix/dist/server.rsa.key\n          -out /opt/adaptix/dist/server.rsa.crt\n          -days 3650\n          -subj \"/C=US/ST=State/L=City/O=Organization/OU=Unit/CN=example.com\"\n\n      - name: Uploading custom profile\n        ansible.builtin.template:\n          src: $$profile$$\n          dest: /opt/adaptix/dist/custom-profile.json\n\n      - name: Creating service\n        ansible.builtin.template:\n          src: $$service$$\n          dest: /etc/systemd/system/adaptix-c2.service\n          mode: \"644\"\n          \n      - name: Reload systemd manager configuration\n        command: systemctl daemon-reload\n        \n      - name: Enable Adaptix C2 service at boot\n        systemd:\n          name: adaptix-c2\n          enabled: yes\n          \n      - name: Start Adaptix C2 service\n        systemd:\n          name: adaptix-c2\n          state: started\n        \n      when: extenders_build_result.rc == 0\n"
}
