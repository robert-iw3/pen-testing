import base64
import argparse
from typing import List

# BOF imports
from core.gunnershell.bofs.base import Bof, register

from colorama import Style, Fore
brightgreen = "\001" + Style.BRIGHT + Fore.GREEN + "\002"
brightyellow = "\001" + Style.BRIGHT + Fore.YELLOW + "\002"
reset = Style.RESET_ALL

@register("ldapsearch")
class LdapSearchBof(Bof):
	base64bof: str = "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mwIAADAAAACbAgAASAMAAEAAAABIAwAA3wMAAFAAAADfAwAA4AMAAGAAAADgAwAAHgQAAGQAAAAeBAAA+wQAAHAAAAD7BAAAGwYAAIAAAAAbBgAA7QcAAIgAAADtBwAAhAoAAJwAAACECgAA+AwAALQAAAD4DAAAUw0AAMQAAABTDQAAjhQAANAAAACOFAAA2RUAAOgAAAAqKiogRHluYW1pY0xvYWQoJXMpIEZBSUxFRCEKQ291bGQgbm90IGZpbmQgbGlicmFyeSB0byBsb2FkLgAqKiogRHluYW1pY0xvYWQoJXMpIEZBSUxFRCEKAHtpfQBiZXJfZmxhdHRlbiBmYWlsZWQhADEuMi44NDAuMTEzNTU2LjEuNC44MDEAbGRhcF9pbml0AFdMREFQMzIAbGRhcF9zZXRfb3B0aW9uVwBsZGFwX2dldF9vcHRpb25XAEZhaWxlZCB0byBlc3RhYmxpc2ggTERBUCBjb25uZWN0aW9uIG9uICVkLgBsZGFwX2JpbmRfcwBCaW5kIEZhaWxlZDogJWx1AGxkYXBfdW5iaW5kAFsqXSBGaWx0ZXI6ICVzCgBbKl0gU2NvcGUgb2Ygc2VhcmNoIHZhbHVlOiAlbHUKAFsqXSBSZXR1cm5pbmcgc3BlY2lmaWMgYXR0cmlidXRlKHMpOiAlcwoAblRTZWN1cml0eURlc2NyaXB0b3IAWyFdIENhbm5vdCByZXR1cm4gbW9yZSB0aGFuICVpIGF0dHJpYnV0ZXMsIHdpbGwgb21pdCBhZGRpdGlvbmFsIGF0dHJpYnV0ZXMuCgBsZGFwX3NlYXJjaF9pbml0X3BhZ2VBAFBhZ2luZyBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgc2VydmVyLCBhYm9ydGluZwBvYmplY3RHVUlEAHJwY3J0NABVdWlkVG9TdHJpbmdBAFJwY1N0cmluZ0ZyZWVBACVzAHBLSUV4cGlyYXRpb25QZXJpb2QAcEtJT3ZlcmxhcFBlcmlvZABjQUNlcnRpZmljYXRlAG1zRFMtQWxsb3dlZFRvQWN0T25CZWhhbGZPZk90aGVySWRlbnRpdHkAbXNEUy1HZW5lcmF0aW9uSWQAYXVkaXRpbmdQb2xpY3kAZFNBU2lnbmF0dXJlAG1TLURTLUNyZWF0b3JTSUQAbG9nb25Ib3VycwBzY2hlbWFJREdVSUQAbVNNUURpZ2VzdHMAbVNNUVNpZ25DZXJ0aWZpY2F0ZXMAdXNlckNlcnRpZmljYXRlAGF0dHJpYnV0ZVNlY3VyaXR5R1VJRABvYmplY3RTaWQAc2VjdXJpdHlJZGVudGlmaWVyAAolczogACwgAHdsZGFwMzIAVW5hYmxlIHRvIGxvYWQgcmVxdWlyZWQgbGlicmFyeQoAbGRhcF9zZWFyY2hfYWJhbmRvbl9wYWdlAFVuYWJsZSB0byBsb2FkIHJlcXVpcmVkIGZ1bmN0aW9uAERDPQBbKl0gRGlzdGluZ3Vpc2hlZCBuYW1lOiAlcwoARmFpbGVkIHRvIHJldHJpZXZlIGRpc3Rpbmd1aXNoZWQgbmFtZS4AWypdIHRhcmdldGluZyBEQzogJXMKAEZhaWxlZCB0byBpZGVudGlmeSBQREMsIGFyZSB3ZSBkb21haW4gam9pbmVkPwBCaW5kaW5nIHRvICVzCgBGYWlsZWQgdG8gYmluZCB0byAlcwBsZGFwX2dldF9uZXh0X3BhZ2VfcwBsZGFwX2NvdW50X2VudHJpZXMARmFpbGVkIHRvIGNvdW50IHNlYXJjaCByZXN1bHRzLgBTZWFyY2ggcmV0dXJuZWQgemVybyByZXN1bHRzAAotLS0tLS0tLS0tLS0tLS0tLS0tLQBsZGFwX2ZpcnN0X2VudHJ5AGxkYXBfbmV4dF9lbnRyeQBsZGFwX2ZpcnN0X2F0dHJpYnV0ZQBsZGFwX2dldF92YWx1ZXNfbGVuQQBsZGFwX2dldF92YWx1ZXMAbGRhcF92YWx1ZV9mcmVlX2xlbgBsZGFwX3ZhbHVlX2ZyZWUAbGRhcF9tZW1mcmVlAGxkYXBfbmV4dF9hdHRyaWJ1dGUAbGRhcF9tc2dmcmVlAApyZXRyaWV2ZWQgJWx1IHJlc3VsdHMgdG90YWwKACoAAAAAAEFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEdDQzogKEdOVSkgMTQtd2luMzIAAAAAAAAAAAAAAAAAEwAAACwAAAAEABoAAAAYAAAABAAjAAAAGAAAAAQAOgAAABgAAAAEAEIAAAAYAAAA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AgAAAAAAzQIAAAAAAAAAAAAAAgAAAAAA5AIAAAAAAAAAAAAAAgAAAAAA/QIAAAAAAAAAAAAAAgAAAAAAFwMAAAAAAAAAAAAAAgAAAAAAMAMAAAAAAAAAAAAAAgAAAAAARAMAAAAAAAAAAAAAAgAAAAAAWgMAAAAAAAAAAAAAAgAAAAAAbgMAAAAAAAAAAAAAAgAAAAAAlAMAAAAAAAAAAAAAAgAAAAAArQMAAAAAAAAAAAAAAgAAAAAAygMAAAAAAAAAAAAAAgAAAAAA3gMAAAAAAAAAAAAAAgAAAAAA+gMAAAAAAAAAAAAAAgAAAAAAGgQAAAAAAAAAAAAAAgAAAAAALAQAAAAAAAAAAAAAAgAAAAAAQgQAAAAAAAAAAAAAAgAAAAAAWgQAAAAAAAAAAAAAAgAAAAAAcgQAAAAAAAAAAAAAAgCGBAAALnJkYXRhJHp6egBTZXJ2ZXJDZXJ0Q2FsbGJhY2sAcHJpbnRvdXRwdXQAaW50ZXJuYWxfcHJpbnRmAGludHN0cmNtcABEeW5hbWljTG9hZABVdGYxNlRvVXRmOABVdGY4VG9VdGYxNgBDb252ZXJ0VW5pY29kZVN0cmluZ1RvQ2hhcgBGb3JtYXRTREZsYWdzAEJhc2U2NGVuY29kZQBJbml0aWFsaXNlTERBUENvbm5lY3Rpb24ARXhlY3V0ZUxEQVBRdWVyeQBjdXN0b21BdHRyaWJ1dGVzAHByaW50QXR0cmlidXRlAGxkYXBTZWFyY2gALnJkYXRhJHp6egBjdXJyZW50b3V0c2l6ZQBsb2FkZWRMaWJyYXJpZXNDb3VudABsb2FkZWRMaWJyYXJpZXMAZnV1aWR0b3N0cmluZwBmcnBjc3RyaW5nZnJlZQBfX2ltcF9NU1ZDUlQkY2FsbG9jAF9faW1wX0JlYWNvbk91dHB1dABfX2ltcF9NU1ZDUlQkZnJlZQBfX2ltcF9NU1ZDUlQkX3ZzY3ByaW50ZgBfX2ltcF9LRVJORUwzMiRHZXRQcm9jZXNzSGVhcABfX2ltcF9LRVJORUwzMiRIZWFwQWxsb2MAX19pbXBfTVNWQ1JUJHZzbnByaW50ZgBfX2ltcF9LRVJORUwzMiRIZWFwRnJlZQBfX2ltcF9NU1ZDUlQkbWVtY3B5AF9faW1wX0xvYWRMaWJyYXJ5QQBfX2ltcF9CZWFjb25QcmludGYAX19pbXBfR2V0UHJvY0FkZHJlc3MAX19pbXBfS0VSTkVMMzIkV2lkZUNoYXJUb011bHRpQnl0ZQBfX2ltcF9LRVJORUwzMiRNdWx0aUJ5dGVUb1dpZGVDaGFyAF9faW1wX1dMREFQMzIkYmVyX2FsbG9jX3QAX19pbXBfTVNWQ1JUJG1hbGxvYwBfX2ltcF9XTERBUDMyJGJlcl9mcmVlAF9faW1wX1dMREFQMzIkYmVyX3ByaW50ZgBfX2ltcF9XTERBUDMyJGJlcl9mbGF0dGVuAF9faW1wX1dMREFQMzIkYmVyX2J2ZnJlZQBfX2ltcF9NU1ZDUlQkc3RydG9rAF9faW1wX01TVkNSVCRfc3RyaWNtcABfX2ltcF9NU1ZDUlQkc3RyY21wAF9faW1wX0FEVkFQSTMyJENvbnZlcnRTaWRUb1N0cmluZ1NpZEEAX19pbXBfS0VSTkVMMzIkTG9jYWxGcmVlAF9faW1wX1NFQ1VSMzIkR2V0VXNlck5hbWVFeFcAX19pbXBfTVNWQ1JUJHN0cnN0cgBfX2ltcF9ORVRBUEkzMiREc0dldERjTmFtZUEAX19pbXBfTkVUQVBJMzIkTmV0QXBpQnVmZmVyRnJlZQBfX2ltcF9GcmVlTGlicmFyeQBfX2ltcF9CZWFjb25EYXRhUGFyc2UAX19pbXBfQmVhY29uRGF0YUV4dHJhY3QAX19pbXBfS0VSTkVMMzIkbHN0cmxlblcAX19pbXBfQmVhY29uRGF0YUludAA="

	def help_menu():
		menu = """
ldapsearch — Execute LDAP query
-------------------------------

Description
  Runs an LDAP query against a Domain Controller and prints matching entries.
  Supports selecting attributes, scoping (BASE/ONE/SUBTREE), result limits,
  optional base DN, and LDAPS.

Usage
  ldapsearch <query> [-a <attributes>] [-c <count>] [--scope <scope>] [--dc <host>] [--dn <baseDN>] [--ldaps]

Positional
  query (required)    LDAP filter, e.g. "(objectClass=*)", "(samAccountName=jdoe)"

Options
  -a, --attributes <list>  Attributes to retrieve (comma-separated). Default: *
						   Examples: name,distinguishedName  |  *,ntSecurityDescriptor
  -c, --count <n>          Max results to return. 0 = no limit (default: 0)
  --scope <n>              Search scope (default: 3)
							 1 = BASE    (current object)
							 2 = LEVEL   (one level)
							 3 = SUBTREE (entire tree)
  --dc <host>              Domain Controller hostname/IP to query (default: auto/current DC)
  --dn <baseDN>            Base DN to search under (default: domain naming context)
						   Example: DC=contoso,DC=com
  --ldaps                  Use LDAPS/SSL (typically TCP 636)

Examples
  # List all objects in the domain root, show common attributes
  ldapsearch "(objectClass=*)" -a "name,objectClass,distinguishedName" -s 2

  # Find computers, include OS fields, top 50 only
  ldapsearch "(objectCategory=computer)" -a "name,operatingSystem,operatingSystemVersion" -c 50 --scope 3

  # Query a specific DC over LDAPS with explicit base DN
  ldapsearch "(samAccountName=jdoe)" --dc dc1.contoso.com --dn "DC=contoso,DC=com" --ldaps 

  # Pull security descriptors (requires rights; potentially large)
  ldapsearch "(objectClass=organizationalUnit)" -a "name,ntSecurityDescriptor" --scope 3 -c 20

Notes
  • Attribute list is comma-separated; "*" returns all standard attributes.
	Adding "ntSecurityDescriptor" can be heavy; use -c to limit results.
  • Scopes: BASE targets exactly the base DN; LEVEL is one level down; SUBTREE walks the entire subtree.
  • --ldaps requires the DC to support LDAPS and the client to trust its certificate.
  • If --dc/--dn are omitted, the BOF attempts to use the current domain’s default context.

Errors
  "Bind failed / server down"           → DC unreachable or LDAPS/cert issue
  "No such object"                      → Base DN incorrect
  "Insufficient access rights"          → Attribute (e.g., ntSecurityDescriptor) requires permissions
  "Size limit exceeded"                 → Tighten filter or set -c to a smaller number
"""
		print(brightgreen + menu + reset)
		return

	@staticmethod
	def args_inject(p):
		# Positional
		p.add_argument("query", help="LDAP filter, e.g. (objectClass=*)")

		# Options
		p.add_argument("-a", "--attributes", default="*", help="Comma-separated attributes (default: *)")
		p.add_argument("-c", "--count", type=int, default=0, help="Max results (0 = no limit)")
		# Use only the long form to avoid collision with core '-s' (int16)
		p.add_argument("--scope", type=int, choices=(1, 2, 3), default=3, help="1=BASE, 2=LEVEL, 3=SUBTREE (default: 3)")
		p.add_argument("--dc", default="", help="DC hostname/IP")
		p.add_argument("--dn", default="", help="Base DN (e.g., DC=contoso,DC=com)")
		p.add_argument("--ldaps", action="store_true", help="Use LDAPS (TCP 636)")
		return

	@staticmethod
	def build_remote_args(ns):
		"""
		Pack into: wstr,cstr,int,int,cstr,cstr,int
		-> [query, attributes, count, scope, dc, dn, ldaps]
		Map to your transport tokens:
		-Z: wide string, -z: cstring, -i: 32-bit int
		"""
		query = ns.query
		attrs = ns.attributes or "*"
		count = int(ns.count if ns.count is not None else 0)
		scope = int(ns.scope if ns.scope is not None else 3)
		dc    = ns.dc or ""
		dn    = ns.dn or ""
		ldaps = 1 if getattr(ns, "ldaps", False) else 0

		return [
			f"-Z:{query}",
			f"-z:{attrs}",
			f"-i:{count}",
			f"-i:{scope}",
			f"-z:{dc}",
			f"-z:{dn}",
			f"-i:{ldaps}",
		]
