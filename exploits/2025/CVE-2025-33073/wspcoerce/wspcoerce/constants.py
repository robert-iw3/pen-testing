########################################
#                                      #
#  RedTeam Pentesting GmbH             #
#  kontakt@redteam-pentesting.de       #
#  https://www.redteam-pentesting.de/  #
#                                      #
########################################

from enum import IntEnum
import uuid

# based on https://github.com/samba-team/samba/blob/master/librpc/idl/wsp_data.idl

"""
* Use en-us as default locale
* see MS-LCID 'Section 2.2 LCID Structure
* for details of this and other language id(s)
"""
WSP_DEFAULT_LCID = 0x00000409
"""
* Max size of rows buffer in getrowsout response
* see MS-WSP 2.2.3.11
"""
MAX_ROW_BUFF_SIZE = 0x0004000

""" values for guidPropertySet """
DBPROPSET_FSCIFRMWRK_EXT = uuid.UUID("A9BD1526-6A80-11D0-8C9D-0020AF1D740E")
DBPROPSET_QUERYEXT = uuid.UUID("A7AC77ED-F8D7-11CE-A798-0020F8008025")
DBPROPSET_CIFRMWRKCORE_EXT = uuid.UUID("AFAFACA5-B5D1-11D0-8C62-00C04FC2DB8D")
DBPROPSET_MSIDXS_ROWSETEXT = uuid.UUID("AA6EE6B0-E828-11D0-B23E-00AA0047FC01")
NULL_UUID = uuid.UUID("00000000-0000-0000-0000-000000000000")
ONE_UUID = uuid.UUID("00000000-0001-0000-0000-000000000000")

""" Chapter and bookmark handle well known values """
DB_NULL_HCHAPTER = 0x00000000
DBBMK_FIRST = 0xFFFFFFFC
DBBMK_LAST = 0xFFFFFFFD
""" properties of DBPROPSET_FSCIFRMWRK_EXT propertyset """
DBPROP_CI_CATALOG_NAME = 0x00000002
DBPROP_CI_INCLUDE_SCOPES = 0x00000003
DBPROP_CI_SCOPE_FLAGS = 0x00000004
DBPROP_CI_QUERY_TYPE = 0x00000007
DBPROP_GENERICOPTIONS_STRING = 0x00000006
DBPROP_USECONTENTINDEX = 0x00000002
DBPROP_IGNORENOISEONLYCLAUSES = 0x00000005
DBPROP_DEFERCATALOGVERIFICATION = 0x00000008
DBPROP_IGNORESBRI = 0x0000000E
DBPROP_GENERATEPARSETREE = 0x0000000A
DBPROP_FREETEXTANYTERM = 0x0000000C
DBPROP_FREETEXTUSESTEMMING = 0x0000000D

""" properties of DBPROPSET_QUERYEXT propertyset """
DBPROP_DEFERNONINDEXEDTRIMMING = 0x00000003
DBPROP_USEEXTENDEDDBTYPES = 0x00000004
DBPROP_FIRSTROWS = 0x00000007
DBPROP_ENABLEROWSETEVENTS = 0x00000010

""" properties of DBPROPSET_MSIDXS_ROWSETEXT """

MSIDXSPROP_ROWSETQUERYSTATUS = 0x02
MSIDXSPROP_COMMAND_LOCALE_STRING = 0x03
MSIDXSPROP_QUERY_RESTRICTION = 0x04
MSIDXSPROP_PARSE_TREE = 0x05
MSIDXSPROP_MAX_RANK = 0x06
MSIDXSPROP_RESULTS_FOUND = 0x07

""" flags of DBPROP_CI_SCOPE_FLAGS property """
QUERY_DEEP = 0x01
QUERY_VIRTUAL_PATH = 0x02

""" query type for BPROP_CI_QUERY_TYPE property """
CINORMAL = 0x00000000

""" properties of DBPROPSET_CIFRMWRKCORE_EXT propertyset """

DBPROP_MACHINE = 0x00000002
DBPROP_CLIENT_CLSID = 0x00000003

"""
* STAT bit constants
"""

""" The asynchronous query is still running. """
STAT_BUSY = 0x00000000
""" The query is in an error state. """
STAT_ERROR = 0x00000001
""" The query is complete and rows can be requested. """
STAT_DONE = 0x00000002
""" The query is comp"""
STAT_REFRESH = 0x00000003
"""
* Noise words were replaced by wildcard characters in the
* content query.
"""
STAT_NOISE_WORDS = 0x00000010
"""
* The results of the query might be incorrect because the
* query involved modified but unindexed files.
"""
STAT_CONTENT_OUT_OF_DATE = 0x00000020
"""
* The content query was too complex to complete or
* required enumeration instead of use of the content index.
"""
STAT_CONTENT_QUERY_INCOMPLETE = 0x00000080
"""
* The results of the query might be incorrect because the
* query execution reached the maximum allowable time.
"""
STAT_TIME_LIMIT_EXCEEDED = 0x00000100

"""
* a const to force an inline array to be evaluated at runtime to
* to get around an incomplete type error
"""
SINGLE_ITEM = 1

""" WSP message types """


class WspMessageType(IntEnum):
    """CPMConnectIn or CPMConnectOut"""

    CPMCONNECT = 0x000000C8
    """ CPMDisconnect """
    CPMDISCONNECT = 0x000000C9
    """ CPMCreateQueryIn or CPMCreateQueryOut """
    CPMCREATEQUERY = 0x000000CA
    """ CPMFreeCursorIn or CPMFreeCursorOut """
    CPMFREECURSOR = 0x000000CB
    """ CPMGetRowsIn or CPMGetRowsOut """
    CPMGETROWS = 0x000000CC
    """ CPMRatioFinishedIn or CPMRatioFinishedOut """
    CPMRATIOFINISHED = 0x000000CD
    """ CPMCompareBmkIn or CPMCompareBmkOut """
    CPMCOMPAREBMK = 0x000000CE
    """ CPMGetApproximatePositionIn or CPMGetApproximatePositionOut """
    CPMGETAPPROXIMATEPOSITION = 0x000000CF
    """ CPMSetBindingsIn """
    CPMSETBINDINGSIN = 0x000000D0
    """ CPMGetNotify """
    CPMGETNOTIFY = 0x000000D1
    """ CPMSendNotifyOut """
    CPMSENDNOTIFYOUT = 0x000000D2
    """ CPMGetQueryStatusIn or CPMGetQueryStatusOut """
    CPMGETQUERYSTATUS = 0x000000D7
    """ CPMCiStateInOut """
    CPMCISTATEOUT = 0x000000D9
    """ CPMFetchValueIn or CPMFetchValueOut """
    CPMFETCHVALUE = 0x000000E4
    """ CPMGetQueryStatusExIn or CPMGetQueryStatusExOut """
    CPMGETQUERYSTATUSEX = 0x000000E7
    """ CPMRestartPositionIn """
    CPMRESTARTPOSITIONIN = 0x000000E8
    """ CPMSetCatStateIn (not supported) """
    CPMSETCATSTATEIN = 0x000000EC
    """ CPMGetRowsetNotifyIn or CPMGetRowsetNotifyOut """
    CPMGETROWSETNOTIFY = 0x000000F1
    """ CPMFindIndicesIn, or CPMFindIndicesOut """
    CPMFINDINDICES = 0x000000F2
    """ CPMSetScopePrioritizationIn or CPMSetScopePrioritizationOut """
    CPMSETSCOPEPRIORITIZATION = 0x000000F3
    """ CPMGetScopeStatisticsIn or CPMGetScopeStatisticsOut """
    CPMGETSCOPESTATISTICS = 0x000000F4


class CDbColId_eKind_Values(IntEnum):
    DBKIND_GUID_NAME = 0x00000000
    DBKIND_GUID_PROPID = 0x00000001


PRSPEC_LPWSTR = 0x00000000
PRSPEC_PROPID = 0x00000001
""" type constants for variant types """


class CBaseStorageVariant_vType_Values(IntEnum):
    VT_EMPTY = 0x0000
    VT_NULL = 0x0001
    VT_I2 = 0x0002
    VT_I4 = 0x0003
    VT_R4 = 0x0004
    VT_R8 = 0x0005
    VT_CY = 0x0006
    VT_DATE = 0x0007
    VT_BSTR = 0x0008
    VT_I1 = 0x0010
    VT_UI1 = 0x0011
    VT_UI2 = 0x0012
    VT_UI4 = 0x0013
    VT_I8 = 0x0014
    VT_UI8 = 0x0015
    VT_INT = 0x0016
    VT_UINT = 0x0017
    VT_ERROR = 0x000A
    VT_BOOL = 0x000B
    VT_VARIANT = 0x000C
    VT_DECIMAL = 0x000E
    VT_FILETIME = 0x0040
    VT_BLOB = 0x0041
    VT_BLOB_OBJECT = 0x0046
    VT_CLSID = 0x0048
    VT_LPSTR = 0x001E
    VT_LPWSTR = 0x001F
    VT_COMPRESSED_LPWSTR = 0x0023
    VT_VECTOR = 0x1000
    VT_ARRAY = 0x2000


""" restriction types """
RTNONE = 0x00000000
RTAND = 0x00000001
RTOR = 0x00000002
RTNOT = 0x00000003
RTCONTENT = 0x00000004
RTPROPERTY = 0x00000005
RTPROXIMITY = 0x00000006
RTVECTOR = 0x00000007
RTNATLANGUAGE = 0x00000008
RTSCOPE = 0x00000009
RTREUSEWHERE = 0x00000011
RTINTERNALPROP = 0x00FFFFFA
RTPHRASE = 0x00FFFFFD
RTCOERCE_ADD = 0x0000000A
RTCOERCE_MULTIPLY = 0x0000000B
RTCOERCE_ABSOLUTE = 0x0000000C
RTPROB = 0x0000000D
RTFEEDBACK = 0x0000000E
RTRELDOC = 0x0000000F


""" Row seek types """
EROWSEEKNONE = 0x00000000
EROWSEEKNEXT = 0x00000001
EROWSEEKAT = 0x00000002
EROWSEEKATRATIO = 0x00000003
EROWSEEKBYBOOKMARK = 0x00000004

WINDOWS_7 = 0x00000700
WINDOWS_2008 = 0x00010700

""" Relops """
PRLT = 0x00000000
PRLE = 0x00000001
PRGT = 0x00000002
PRGE = 0x00000003
PREQ = 0x00000004
PRNE = 0x00000005
PRRE = 0x00000006
PRALLBITS = 0x00000007
PRSOMEBITS = 0x00000008
PRALL = 0x00000100
PRANY = 0x00000200

PROPAGATE_NONE = 0
PROPAGATE_ADD = 1
PROPAGATE_DELETE = 2
PROPAGATE_MODIFY = 3
PROPAGATE_ROWSET = 4

ROWSETEVENT_ITEMSTATE_NOTINROWSET = 0
ROWSETEVENT_ITEMSTATE_INROWSET = 1
ROWSETEVENT_ITEMSTATE_UNKNOWN = 2

ROWSETEVENT_TYPE_DATAEXPIRED = 0
ROWSETEVENT_TYPE_FOREGROUNDLOST = 1
ROWSETEVENT_TYPE_SCOPESTATISTICS = 2

DBCOMPARE_LT = 0x00000000
DBCOMPARE_EQ = 0x00000001
DBCOMPARE_GT = 0x00000002
DBCOMPARE_NE = 0x00000003
DBCOMPARE_NOTCOMPARABLE = 0x00000004

VECTOR_RANK_MIN = 0x00000000
VECTOR_RANK_MAX = 0x00000001
VECTOR_RANK_INNER = 0x00000002
VECTOR_RANK_DICE = 0x00000003
VECTOR_RANK_JACCARD = 0x00000004

DBAGGTTYPE_BYNONE = 0x00000000
DBAGGTTYPE_SUM = 0x00000001
DBAGGTTYPE_MAX = 0x00000002
DBAGGTTYPE_MIN = 0x00000003
DBAGGTTYPE_AVG = 0x00000004
DBAGGTTYPE_COUNT = 0x00000005
DBAGGTTYPE_CHILDCOUNT = 0x00000006
DBAGGTTYPE_BYFREQ = 0x00000007
DBAGGTTYPE_FIRST = 0x00000008
DBAGGTTYPE_DATERANGE = 0x00000009
DBAGGTTYPE_REPRESENTATIVEOF = 0x0000000A
DBAGGTTYPE_EDITDISTANCE = 0x0000000B

ESEQUENTIAL = 0x00000001
ELOCATEABLE = 0x00000003
ESCROLLABLE = 0x00000007
EASYNCHRONOUS = 0x00000008
EFIRSTROWS = 0x00000080
EHOLDROWS = 0x00000200
ECHAPTERED = 0x00000800
EUSECI = 0x00001000
EDEFERTRIMMING = 0x00002000
ENABLEROWSETEVENTS = 0x00800000
EDONOTCOMPUTEEXPENSIVEPROPS = 0x00400000

CI_STATE_SHADOW_MERGE = 0x00000001
CI_STATE_MASTER_MERGE = 0x00000002
CI_STATE_ANNEALING_MERGE = 0x00000008
CI_STATE_SCANNING = 0x00000010
CI_STATE_LOW_MEMORY = 0x00000080
CI_STATE_HIGH_IO = 0x00000100
CI_STATE_MASTER_MERGE_PAUSED = 0x00000200
CI_STATE_READ_ONLY = 0x00000400
CI_STATE_BATTERY_POWER = 0x00000800
CI_STATE_USER_ACTIVE = 0x00001000
CI_STATE_LOW_DISK = 0x00010000
CI_STATE_HIGH_CPU = 0x00020000

STORESTATUSOK = 0x00000000
STORESTATUSDEFERRED = 0x00000001
STORESTATUSNULL = 0x00000002

DB_S_ENDOFROWSET = 0x00040EC6

XOR_CONST = 0x59533959
E_UNEXPECTED = 0x8000FFFF
WIN_UPDATE_ERR = 0x80070003

QUERY_SORTASCEND = 0x00000000
QUERY_DESCEND = 0x00000001
