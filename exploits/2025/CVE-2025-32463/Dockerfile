# ----- Dockerfile -----
FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

# 1) Build tool and deps
RUN apt-get update && \
    apt-get install -y build-essential wget libpam0g-dev libselinux1-dev zlib1g-dev \
                       pkg-config libssl-dev git ca-certificates && \
    rm -rf /var/lib/apt/lists/*

# 2) Build vulnerable sudo(1.9.16p2)
WORKDIR /opt
RUN wget https://www.sudo.ws/dist/sudo-1.9.16p2.tar.gz && \
    tar xzf sudo-1.9.16p2.tar.gz && \
    cd sudo-1.9.16p2 && \
    ./configure --disable-gcrypt --prefix=/usr && make && make install

# 3) Make a pwn user
RUN useradd -m -s /bin/bash pwn

# 4) Copy PoC script
COPY sudo-chwoot.sh /home/pwn/sudo-chwoot.sh
RUN chown pwn:pwn /home/pwn/sudo-chwoot.sh

# 5) Swith to the pwn user
USER pwn
WORKDIR /home/pwn

# 6) Run shell
CMD ["/bin/bash"]
