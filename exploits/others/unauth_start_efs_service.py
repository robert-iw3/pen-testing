#!/usr/bin/env python3

# pip install impacket

import sys
from impacket import uuid
from impacket.dcerpc.v5 import transport, epm
from impacket.dcerpc.v5.rpcrt import RPC_C_AUTHN_LEVEL_NONE, DCERPCException
from impacket.dcerpc.v5.dcomrt import IObjectExporter


if len(sys.argv) != 2:
    print("Usage: %s <target>" % (sys.argv[0]))
    quit()


EFS_UUID = uuid.uuidtup_to_bin(("df1941c5-fe89-4e79-bf10-463657acf44d", "1.0"))

try:
    stringBinding = epm.hept_map(sys.argv[1], EFS_UUID, protocol='ncacn_ip_tcp')
    rpctransport = transport.DCERPCTransportFactory(stringBinding)

    dce = rpctransport.get_dce_rpc()
    dce.set_auth_level(RPC_C_AUTHN_LEVEL_NONE)
    dce.connect()
    dce.bind(EFS_UUID)
    dce.disconnect()

except DCERPCException:
    print("[*] EFS should be running now.")

